from flask import Flask, jsonify, request
import json
import numpy as np
import numpy as np
import torch
import time

from model_resnet1d import *
from ronin_resnet import *



app = Flask(__name__)
def preprocess(imu):
    #input numpy shape (200,6)
    imu=imu[0]
    gyro_uncalib=imu[:,:3]
    acce_uncalib=imu[:,3:]
    gyro_bias=0
    acce_bias=0
    gyro = gyro_uncalib - gyro_bias
    acce = acce_uncalib-acce_bias

    z=np.concatenate([gyro,acce],axis=1)
    zz=torch.tensor(z,device="cuda:0",dtype=torch.float32)
    zz=torch.unsqueeze(zz, 0)
    zz=torch.transpose(zz,1,2)

    return (zz)
_fc_config = {'fc_dim': 512, 'in_dim': 7, 'dropout': 0.5, 'trans_planes': 128}
network = ResNet1D(6, 2, BasicBlock1D, [2, 2, 2, 2],
                           base_plane=64, output_block=FCOutputModule, kernel_size=3, **_fc_config)
checkpoint = torch.load("D:\\000_Mora\\FYP\\RONiN\\Pre_trained models\\ronin_resnet\\ronin_resnet\\checkpoint_gsn_latest.pt")
network.load_state_dict(checkpoint['model_state_dict'])
device = torch.device('cuda:0')
network.eval().to(device)

# incomes = [
#     { 'description': 'salary', 'amount': 5000 }
# ]

a = np.random.uniform(0.1, 0.8, size=(1, 200, 6))
reshaped_tensor = a.reshape((200, 6))

# Convert the reshaped tensor to a nested list
data_list = reshaped_tensor.tolist()

# Create a dictionary with the nested list
json_data = {'data': [[[0.17636842687667054, 0.5048663088839153, 0.3240739260773705, 0.6683606143524844, 0.26163459627853775, 0.159132038343412], [0.15106449797213906, 0.32680958232055723, 0.6571332989797168, 0.46512562363722976, 0.6410883709059902, 0.1963918388846977], [0.29880434155705005, 0.15798399370546767, 0.14582831706594826, 0.3295359323434257, 0.23104113081171912, 0.1490867174573126], [0.30788178610224615, 0.4193923922292562, 0.7800848662970552, 0.709141279194295, 0.32612721508509945, 0.47381572338852773], [0.5830246675032531, 0.49709706853304925, 0.3530429473826955, 0.7980404751708203, 0.29207188167796294, 0.28932866299512605], [0.13411517501616568, 0.23441871844444392, 0.5098833282634856, 0.24173276416028566, 0.5884678392633044, 0.15767595020258018], [0.4855313760221258, 0.738361525191829, 0.32393416278238457, 0.37033204451342683, 0.4911652441695439, 0.6390299234736351], [0.4511594668135075, 0.10616574183382743, 0.22147474512667437, 0.19692951263872197, 0.6801786073257005, 0.18057818279232968], [0.16871658758678612, 0.2842598776660341, 0.5643380198269535, 0.5752644171750307, 0.7597958444815769, 0.2895249272599286], [0.7675885395635531, 0.10489496577354418, 0.49474972716812293, 0.6442846404155264, 0.18910968874143974, 0.14364862518923], [0.5101272002211837, 0.3464379297643325, 0.6570402637817914, 0.3014457239796962, 0.7143002370652448, 0.5467293728782918], [0.38955156638925537, 0.7883868958196852, 0.6290832513949429, 0.3494892754310985, 0.6399112416126471, 0.7462921896209557], [0.34246122477998275, 0.17601107474574068, 0.716215650561605, 0.6076992175213103, 0.43351866437714315, 0.29579731548867827], [0.3452836410558191, 0.7235270854341213, 0.7895702135213101, 0.42594509789360513, 0.5136732039037523, 0.676710832990381], [0.2064129930107699, 0.20262585589669702, 0.20490063444411927, 0.7438192189175086, 0.40200578855744884, 0.6013236694201255], [0.7704033247688369, 0.6252407477919667, 0.10506855342158147, 0.1462511995778962, 0.33247479224143783, 0.7255033242938559], [0.6734947733432257, 0.3076300853761408, 0.7109898831414456, 0.5274698069097693, 0.16109403375188847, 0.18237972572868744], [0.34480954103229666, 0.39424949302931656, 0.6467432307360641, 0.5656318768559302, 0.6035752002576636, 0.27338040332161073], [0.684363803273852, 0.26837857832764483, 0.5258106549328151, 0.6692254506327094, 0.660907860891209, 0.28853380810511264], [0.5567015797577276, 0.376928601439689, 0.3668940147944473, 0.11185187428174094, 0.2736541902247421, 0.5822742412463019], [0.648713394501645, 0.715794815138078, 0.14948337701200926, 0.13696821807550486, 0.4572945009751074, 0.6567071783688824], [0.26186539115232155, 0.4871992864134601, 0.7898144567955304, 0.14679132242568327, 0.7010803112856588, 0.630610180103118], [0.5173138696828216, 0.6069146906527301, 0.6938604723914645, 0.4509901731541943, 0.794868465540376, 0.6260637834372688], [0.20388524574501643, 0.29695788960735314, 0.6272885125639817, 0.5277775400644809, 0.4737362106045139, 0.2275474428392896], [0.10240449697956633, 0.12679277569076328, 0.7132125319326671, 0.5008133558982679, 0.6745307711167736, 0.5563597081064356], [0.7703142289133309, 0.2376078238958376, 0.7814674355687328, 0.27721097271865786, 0.17982445874312963, 0.7254189132570201], [0.3802166948945471, 0.5215162059855201, 0.2849584498008649, 0.17705585961018677, 0.1516439733869248, 0.3095971266410904], [0.17297934507666543, 0.13966043387267735, 0.157911654824196, 0.46364396433090294, 0.12840572276364925, 0.3290518154729458], [0.6458671958612833, 0.6947859431123228, 0.39554789108906785, 0.7393753191439628, 0.16434324569312905, 0.570447924460728], [0.3886926302351742, 0.2148245040683724, 0.1437498430197556, 0.5997600546406827, 0.41256776510590554, 0.4707775345605528], [0.11098620986029252, 0.19183591860432792, 0.6121708039834849, 0.649624648666657, 0.15259244304309977, 0.3947751814156715], [0.6859382256110211, 0.5878900873648515, 0.5478590915508966, 0.16683819646475945, 0.4330059391105078, 0.26475793739738546], [0.5532192811291254, 0.3316297152332516, 0.7266912622880111, 0.5482127289556291, 0.6848719646082604, 0.5950454627489178], [0.6528382408504497, 0.6082971711457753, 0.7446451230048666, 0.6284134829895968, 0.434100625326307, 0.4402111547264237], [0.628665994604195, 0.16383377143518407, 0.26482338714243336, 0.2622115941140229, 0.4286160383139016, 0.39139421961923593], [0.2679018204300741, 0.7595182515852164, 0.4426405005156099, 0.7194627065851765, 0.43651766028877825, 0.2887597891348473], [0.2165495457352224, 0.19920249318451277, 0.6162529368291555, 0.20929091204330846, 0.10006379127775082, 0.6377000952790163], [0.1284559788497336, 0.13986614148898402, 0.6442980645284541, 0.7441582998637025, 0.292095723544382, 0.7217736942967609], [0.44968583313792043, 0.17410531098919968, 0.4281572152169165, 0.3772347890392863, 0.4643771572637989, 0.17711791248182618], [0.34713356355089653, 0.12010519687362797, 0.5267233894772709, 0.6912521443229299, 0.41639041912764785, 0.15562224798057833], [0.4432502713170864, 0.6776109692068892, 0.21493484385294948, 0.6211143154829515, 0.45351588872134063, 0.7164867650562641], [0.7503959424331166, 0.477100212895733, 0.6515119488579737, 0.7845298698953708, 0.42635587919901197, 0.33722213746130436], [0.21123543472713835, 0.28017018895986096, 0.7012857871613312, 0.15878129681118502, 0.5358365426665953, 0.66749533440049], [0.4532934566252461, 0.7993096484779075, 0.5974547460702999, 0.3441866524747891, 0.3849138133928589, 0.7383095119855894], [0.6679616341717919, 0.18966515811209428, 0.7984700514878577, 0.3002125327384564, 0.1286376568355862, 0.3892047314984627], [0.4987435096663825, 0.6032523568443781, 0.10956582799921043, 0.11695076141357869, 0.618823026941019, 0.1198611885587107], [0.6279149783448535, 0.6357923221324855, 0.7512717094017547, 0.7991455123819406, 0.4092550858538483, 0.4426791363535745], [0.5615752433520166, 0.40233720114601446, 0.7068504047253942, 0.1634988560051263, 0.29082469261143146, 0.7412821398873849], [0.5090085279385972, 0.1551542646666592, 0.4859137470873912, 0.23163404853226638, 0.4040742970975042, 0.6635295173513001], [0.6258728490382156, 0.18910442188916757, 0.45416354124788705, 0.2204216197486379, 0.42929793767327284, 0.6007028581951461], [0.5202903774708968, 0.2280192093392181, 0.6612776633007602, 0.22157257952943676, 0.13335766925130238, 0.5148259021723761], [0.6981774397054005, 0.7766081321148539, 0.22389368560662554, 0.6038597286520514, 0.16148299507705602, 0.14095841169009618], [0.4686666624167718, 0.6446798933141485, 0.49417906154059044, 0.3165420075655241, 0.14418896551767058, 0.6307035774103003], [0.6920007723804117, 0.567274968120603, 0.6524871604226467, 0.7344266102320965, 0.4123793450803722, 0.4588683306495225], [0.4831674825251929, 0.7568971034405261, 0.5271973778235532, 0.6300380219338135, 0.5564282580494353, 0.7315280641169085], [0.5189534881603655, 0.7994985780078785, 0.4852962715550746, 0.5986346519777833, 0.49619107887591607, 0.37181989540609695], [0.7498942437344202, 0.17512136789891825, 0.48439508281573107, 0.7652723602131434, 0.21815096584300692, 0.7937108122432637], [0.7319638263308723, 0.4136699249596212, 0.516021088148794, 0.5112784721793527, 0.4133482484782399, 0.3361340503332324], [0.5634270698027465, 0.5440228079034658, 0.30423043112898474, 0.39022261150957305, 0.20616348253270284, 0.39895257353149927], [0.2541062635745329, 0.6200503048600238, 0.253126550824381, 0.6926529041613856, 0.2360678424096365, 0.2716937668831294], [0.2734083663779204, 0.6458656290886338, 0.22703981768473303, 0.4717845810795174, 0.5819511646247147, 0.2942318504023806], [0.4285601172193477, 0.18923881214537572, 0.551381937598689, 0.2631867106872572, 0.5470061894475385, 0.6760995685740796], [0.48985871186068974, 0.43016599401013467, 0.3177590858571223, 0.5718472477567825, 0.1853992025907275, 0.1737303794711197], [0.36671542013311864, 0.2910318163150236, 0.6639948173976442, 0.2826764007036921, 0.730068020777384, 0.2049184751832416], [0.4221902566298714, 0.4690616472982502, 0.7518722451036087, 0.586039296145405, 0.14361079844151714, 0.21060057310416846], [0.6495223619479173, 0.7743282745100691, 0.14443786627269378, 0.28155753402407147, 0.4990158781391807, 0.48502400660890965], [0.7905345439292467, 0.7424572589871417, 0.2296103300988696, 0.5840696926309656, 0.251842648422713, 0.6562782374359926], [0.41920411388682965, 0.25092623358749644, 0.5411084735062186, 0.42045680883193326, 0.46456694677389765, 0.5460359649313093], [0.14656676494671336, 0.40831385742375303, 0.1608955859765789, 0.25684396843150137, 0.4813854435513857, 0.5945425117800117], [0.3252802876372328, 0.5543287017371525, 0.471324156884811, 0.10950678403623904, 0.5364730511129524, 0.7778480079204502], [0.2760301083550819, 0.5860783800618119, 0.7943314331626453, 0.4568787728685535, 0.19117755141410064, 0.22773130841068914], [0.43344610179548904, 0.6793380972674197, 0.2613086029644448, 0.4111537140168411, 0.44356342219254463, 0.6870474905042943], [0.790822201781701, 0.2301515248726055, 0.5260143881437215, 0.7944456320708292, 0.3928812234366694, 0.17470219317282315], [0.6413045071046181, 0.3072036506080796, 0.5232995038684802, 0.4990721150616262, 0.6942033380494734, 0.5429461626509804], [0.38647236130836216, 0.6372347657198915, 0.2534491601662011, 0.7143862817687928, 0.43351519097918734, 0.32253742248025663], [0.5411022889932557, 0.34622750510384237, 0.5575474121407632, 0.3981588289801775, 0.7564749891968282, 0.5187721080699293], [0.437095988659137, 0.6425884276554148, 0.5559498260169221, 0.5419594735796404, 0.7616535548095861, 0.34218370083304533], [0.7505103744390849, 0.4946465563846233, 0.10074061207160297, 0.22465632084742806, 0.5836286210291893, 0.7580089944107135], [0.5109981832137954, 0.6765958880530281, 0.41819947569314464, 0.5991213947424646, 0.7189547806707146, 0.25343730373720175], [0.5454336202382472, 0.7157459309070668, 0.7491774292127616, 0.38402531506996984, 0.19529479226325847, 0.563091283856112], [0.6515513594002179, 0.22452508673131347, 0.18786895109559565, 0.49093619959252477, 0.6861463030521939, 0.7033352979025862], [0.4835442172201211, 0.28650467418549175, 0.4991715538078796, 0.1533891203268626, 0.7718481257271177, 0.1687282089736144], [0.7555900796439718, 0.12811332458506286, 0.4806804863403691, 0.5535130473515689, 0.19290821956229715, 0.6283615707228526], [0.12302894829869906, 0.49103184593803717, 0.7952815968431606, 0.32014732746108443, 0.269330840168023, 0.4110483547583551], [0.37150275463873494, 0.21774184963329196, 0.6774989860379473, 0.5707636136343797, 0.19266291619315146, 0.11541991155537852], [0.5727323751341448, 0.6554766639573673, 0.7608060833098965, 0.2552525106627511, 0.6905205447753051, 0.2060838965150405], [0.1539966912343859, 0.6228058411679107, 0.48282741357104375, 0.5475827392057886, 0.7831430218720291, 0.439056435644404], [0.6930798077232729, 0.6369073803683585, 0.4660069699396828, 0.2917234616799682, 0.4504379946752698, 0.5094533496423477], [0.19517043971463321, 0.6115246559973605, 0.726027068513324, 0.35119723587579, 0.27171687228940344, 0.4045835270116599], [0.14401196796104565, 0.10021314953474068, 0.4426981812332177, 0.48361559161380685, 0.7928554000915802, 0.7233086685932991], [0.3883395131352171, 0.7067779884722692, 0.6917350506132441, 0.7931157967351883, 0.24271348618303876, 0.5357874172808728], [0.20017817248173359, 0.5680165556252473, 0.7722398131172156, 0.48559612574579725, 0.5314110933647268, 0.7056527076311276], [0.3229686474110711, 0.41674040899584686, 0.5480811691940533, 0.22689650396783667, 0.274766053694865, 0.5294642095636838], [0.1349944929008959, 0.16959817403954275, 0.7803518998576034, 0.13243793816124716, 0.5674016748325051, 0.1502027616496228], [0.6391241566994743, 0.17201533554801365, 0.7835764358350181, 0.40727177549348803, 0.6726165410904402, 0.273094026177569], [0.38080602879354974, 0.7774999663879232, 0.39002884872389143, 0.7303179372989137, 0.6033594803825841, 0.6213311196861417], [0.317206442868865, 0.5879993113751534, 0.210384476327487, 0.3736583152956068, 0.251143529425469, 0.6811300578123353], [0.5552482526776531, 0.22271791229442572, 0.4323124391975156, 0.7955324510777209, 0.7905442336358861, 0.3977589731239699], [0.6890634098837515, 0.7844038531184611, 0.3072165885843392, 0.5131087646907321, 0.5688333815389517, 0.11981525162207803], [0.6300390378242903, 0.6853331368636509, 0.20343711204725767, 0.5330422786125442, 0.3151160904140239, 0.4885441513891743], [0.1941410651794008, 0.7066785319116331, 0.6086934229986676, 0.47526566775676915, 0.11507331734684752, 0.6376229283244162], [0.7541146708688578, 0.7303440712587803, 0.6832356272808379, 0.12024959941343502, 0.30692548222706617, 0.12685455296778073], [0.5292537085002242, 0.37161421040719533, 0.7308471175924075, 0.33889506625174093, 0.6259215124882272, 0.4359326089996698], [0.27147414405130105, 0.5793195476524367, 0.13907053756287202, 0.3335842760380896, 0.10299302263350407, 0.12372901576402705], [0.31695743933259257, 0.7357965330590918, 0.18472776879368952, 0.329333665806191, 0.49557240765360366, 0.19283161532824422], [0.529039651967457, 0.7774073311201954, 0.2827849989286936, 0.48706190553996886, 0.7933505658127056, 0.7418241870434601], [0.6990992447799801, 0.5295014234145268, 0.6281504280160091, 0.355339157183734, 0.718261110979566, 0.5182746688777021], [0.7591986961223223, 0.19118067174590153, 0.2000067222815723, 0.6646370556255403, 0.690384558850456, 0.7064901734704105], [0.6260934389146963, 0.30928951390110765, 0.23906680362069474, 0.17625578814261633, 0.7719831707025446, 0.21060717856236344], [0.5660682695957993, 0.3508269073276997, 0.7868236004324343, 0.6024787512148707, 0.15261931502971837, 0.5014911785200421], [0.3279057315173811, 0.2936499787437084, 0.514497438176118, 0.40072995270613443, 0.6021910698222177, 0.3395182881253506], [0.7860060886183107, 0.7336956759166141, 0.37767639500954153, 0.2724057947033628, 0.2431432309035392, 0.2769522397835662], [0.6155614421606834, 0.7582424275673663, 0.6394426118759297, 0.3223748809516735, 0.7917444054965358, 0.4499738309029556], [0.5225612832604288, 0.3919716166878833, 0.20548933704353517, 0.4488039809184704, 0.5875973609819928, 0.4771447086194127], [0.5040374967277242, 0.6709901959690607, 0.549157912309597, 0.4301481592345874, 0.38114110618385155, 0.3071171240845876], [0.28705542731808714, 0.40481676732620686, 0.7076291014724132, 0.6212481900504886, 0.1647933680897315, 0.2929105265424251], [0.6162762165130148, 0.7166808452615633, 0.735146675708294, 0.6904317157406735, 0.7519912862995584, 0.4461510400161013], [0.38163556346392224, 0.7954381583596127, 0.4629976233262987, 0.6012608156422515, 0.37595676303776826, 0.4008037106464676], [0.4539106109307902, 0.3998096658885091, 0.68479121972256, 0.7993062746236063, 0.2300644153850683, 0.3026236658283182], [0.6052640954729522, 0.11497094574159553, 0.18567055274458308, 0.2596919218760919, 0.7103037892193474, 0.4001249018528118], [0.19121416774311217, 0.4538934172032295, 0.1321786218534453, 0.6931622916212778, 0.3037851839053552, 0.12674774711467857], [0.7561914593195201, 0.11606341309575252, 0.28899471414823086, 0.7465260506414313, 0.4985221151981746, 0.5937238868108106], [0.41381609634544625, 0.7861170154554381, 0.6948580630726184, 0.506106542632985, 0.6512650504253618, 0.5414110606991681], [0.5987721417592357, 0.4225627589399551, 0.7185346945563978, 0.3918812440972238, 0.3901944285044868, 0.7460253741812702], [0.534449056988587, 0.32508273346782934, 0.6940336519660621, 0.6064594688604187, 0.5187004945622299, 0.1304142710432361], [0.2445276515643533, 0.6949675792933108, 0.11698042261730524, 0.6976973396901109, 0.5673582744234664, 0.6543363614280413], [0.2641361278565565, 0.46695231743575205, 0.7923870850349471, 0.6740373352954498, 0.20616804891393267, 0.28973323549252844], [0.13180585727725702, 0.14559164501476102, 0.7433430753871937, 0.32133113952183956, 0.3059754086710604, 0.6749512666540154], [0.1460193674976355, 0.27713261841008074, 0.13992379729171114, 0.49716370665692333, 0.6856691885615269, 0.1848813071739548], [0.3393637632127182, 0.461411839967942, 0.7070995610128629, 0.44666498657606046, 0.5449166858914761, 0.6677964115691859], [0.4394773385605032, 0.693177617625393, 0.2179536663905599, 0.392661842910753, 0.547029205740001, 0.38478031338041807], [0.6733493002231711, 0.3298091169157117, 0.15890904288210042, 0.20107950531387486, 0.4839343787929967, 0.7567193571725306], [0.45967238925301934, 0.6765032970120348, 0.20708044487765637, 0.7414567259321663, 0.5986843513549613, 0.3703885342186092], [0.3944267395144302, 0.19982036423573238, 0.42775888276350027, 0.6755847730493331, 0.4608023911597582, 0.4350094553236691], [0.394117755963436, 0.3623099977341333, 0.5628707222437836, 0.11614749247681494, 0.6768050979404729, 0.534767421466923], [0.7489251183191671, 0.636749391668051, 0.5898703687000734, 0.4755950889763334, 0.5430194119671524, 0.34552849475586195], [0.7984207235046683, 0.406295636900352, 0.2225739901481033, 0.25052638076525224, 0.49388011939604437, 0.11809593822006342], [0.25373552353729045, 0.6015388912219634, 0.5289346629521491, 0.30323594769177664, 0.7202940726641704, 0.5813985340196127], [0.7813850470096354, 0.6101725317595882, 0.7023028474265912, 0.7799930998945707, 0.4275801116683329, 0.3068427142716217], [0.39467530901606296, 0.27871061155049376, 0.5001248675653892, 0.467484579418614, 0.369762466354552, 0.20002048489000734], [0.15574200638951205, 0.49095115871055683, 0.4107715405563721, 0.5555450276428917, 0.5206558406528574, 0.3023027707695751], [0.6226913871321185, 0.3816302750352918, 0.23704144473531089, 0.10876687254440365, 0.7207953245495234, 0.198740134485883], [0.35704536026128886, 0.7005723572305006, 0.49994578858994565, 0.4111095198698975, 0.6310176386298391, 0.13292537897842685], [0.350354226797683, 0.5845846646796898, 0.7016583613758476, 0.7966906326880352, 0.4716011888606918, 0.35035911900639216], [0.624619462751535, 0.34488822752829446, 0.6340173840375034, 0.1673496044616657, 0.382900120772799, 0.27080077773895783], [0.6533706813869478, 0.2954673936475191, 0.5435993739075922, 0.49247546160605293, 0.5121142228631758, 0.2556322446158051], [0.3488603446703376, 0.6881304305928893, 0.3447296624613809, 0.7771930476149609, 0.15648909461804625, 0.23330207006121853], [0.41740272255033706, 0.448187024520758, 0.42238451183204617, 0.12723753252816242, 0.7324660618538503, 0.12113139593261399], [0.4255047917823238, 0.11611761532391428, 0.6070942167623256, 0.7541651030803853, 0.23170885681970313, 0.5144419751031343], [0.29468718671168165, 0.11519569752200935, 0.7788463313914865, 0.1391493044717085, 0.4991512631995514, 0.2251357868535543], [0.32789263120793355, 0.341035496810448, 0.4623703492543094, 0.2950022334176593, 0.5117563763495709, 0.719028962541603], [0.6658681043342983, 0.2631568510242688, 0.3362322327926258, 0.2573421632816103, 0.29739064193004994, 0.636410238765074], [0.711621551421164, 0.17169460797096464, 0.57041280143566, 0.46300170045412103, 0.36846995474663746, 0.24152322721418645], [0.32510656495280077, 0.2271473654749149, 0.24707189809114727, 0.14334420612046872, 0.27770044055526444, 0.7622810924422622], [0.7912368193874748, 0.12703791583295998, 0.7152130963241843, 0.5233907349540264, 0.2124024993773232, 0.1502160454996538], [0.4859512642125532, 0.2352229202825548, 0.6456714144044042, 0.7125497279082618, 0.12392829767142877, 0.3990063161715167], [0.14114915034658188, 0.4168051831845885, 0.7376651369670646, 0.2840124000404154, 0.37549719136208537, 0.3272390019958721], [0.24671272926821214, 0.42165407195913684, 0.10825561490944037, 0.5835976262734336, 0.5120645463879232, 0.12538244712469682], [0.7853366595544535, 0.5496480264359532, 0.3913590652141824, 0.4409876759703085, 0.5116262268621877, 0.4965401890183132], [0.35531319572028464, 0.11947275998012144, 0.2607676634605639, 0.2544977219239546, 0.2920446104941368, 0.47976163164999], [0.2675875800005679, 0.468099807835582, 0.14736666035970292, 0.26237060358879677, 0.34108488433401074, 0.6710863501677461], [0.6702606042543497, 0.24547492695886616, 0.686271172015181, 0.6824604486583126, 0.4174085846365081, 0.10868532974623604], [0.7236045429009762, 0.2996061657305865, 0.7694994314617212, 0.41409378911332395, 0.14910946086446009, 0.6380019043406464], [0.35536626210822286, 0.43284401070367384, 0.23755156321836915, 0.7441292319655017, 0.11560388158498934, 0.6302572722376136], [0.6060015321122912, 0.7833129169821754, 0.5844088689017068, 0.7220950381872592, 0.44340125377304007, 0.7652099611113081], [0.7702570541758319, 0.3101632654191161, 0.524082370731898, 0.697873480909235, 0.6328832073898133, 0.6689599470972855], [0.6041592646738825, 0.15477631737536868, 0.13382529319507583, 0.270612075179664, 0.4075713770724435, 0.2548504550251684], [0.473133874316886, 0.2417754668548428, 0.6871680282868619, 0.5144011751386672, 0.535735348197752, 0.7104194787302874], [0.5348219028179941, 0.5344140713671437, 0.15480018425732175, 0.4068255986383952, 0.173105124043762, 0.37657307053718836], [0.3997617390537367, 0.6184768704796848, 0.488377498652126, 0.764651078628893, 0.25919004996877193, 0.4690656051224372], [0.17279424987895403, 0.5144535517691589, 0.2752490391849483, 0.5148182273123612, 0.48063321057850417, 0.6549100344728375], [0.28408049945985436, 0.7179816170852379, 0.679363856583069, 0.44942396975032084, 0.4878615265814057, 0.12493104846875461], [0.33211154050612557, 0.4483728728563666, 0.5527393285755775, 0.11967849892814292, 0.7947867374151604, 0.4593958346811997], [0.24353419636495355, 0.6673216718834957, 0.35735590964932207, 0.2404960439937177, 0.4827536122644276, 0.24999599919348148], [0.26619998721354876, 0.16454288121364205, 0.29177885663999853, 0.6657503270901886, 0.5953804792535842, 0.6891701012076301], [0.3257081627340921, 0.17149078403808043, 0.12468520717188536, 0.27676874794049466, 0.15713956813487107, 0.7613236472815843], [0.19975354690134012, 0.4096128786967117, 0.3653883379312962, 0.35507376968122906, 0.4181861949875054, 0.20277681995843969], [0.45981790158792313, 0.2299026955246301, 0.7259524524607041, 0.4491556335543091, 0.2284554513092548, 0.3120306068853329], [0.4504956369225852, 0.12197486308351298, 0.472452719670588, 0.3515770527089138, 0.3897663704315648, 0.5395919640559111], [0.3075123802104932, 0.23780337540906557, 0.3415950051149629, 0.6038983809815056, 0.4845222882712128, 0.16298042940448185], [0.7739366797335602, 0.784443014916098, 0.37031653636635975, 0.2791652653691, 0.34071021424701964, 0.6116265453910954], [0.7596103832882544, 0.7819398162547677, 0.7814447846525029, 0.14272512663894973, 0.5668096178208751, 0.500956137599954], [0.3974737220712604, 0.6664965294220037, 0.6993790141738531, 0.14411508505612156, 0.20654252121592626, 0.4946003270804482], [0.6428283063986202, 0.5277934653393072, 0.20870604424009548, 0.24153606611214878, 0.3328473610618116, 0.1566035070580332], [0.21958726087545333, 0.13441991218850874, 0.6318522117372452, 0.5713370208491321, 0.45584906583408236, 0.12978754458098418], [0.26132568789572186, 0.12214415562261571, 0.7890462551775768, 0.41258884599317247, 0.4081898727046861, 0.2834882105852856], [0.4935855373707764, 0.11336718685551748, 0.683709094721238, 0.660208103368556, 0.5962790361618497, 0.43328391323728876], [0.7208363178928489, 0.6687695704796858, 0.6411132371762582, 0.7014147677254488, 0.423815224863651, 0.2452880466589505], [0.373449661460971, 0.5613663809515294, 0.7052669415291815, 0.6235561636029119, 0.5781379041809379, 0.2664594061164877], [0.7890812182898571, 0.13662368230116553, 0.45034329639417825, 0.200189572658797, 0.4988735084555581, 0.30727194616837494], [0.17055582713688455, 0.6809636573686036, 0.3696537364637835, 0.37206547099255516, 0.24991070022105857, 0.5552366598124712], [0.12729642211488354, 0.4892162960737978, 0.6146352693765161, 0.3829572577371386, 0.46294987503255625, 0.5599844878884012], [0.7388123126998555, 0.281516938474098, 0.13752057820355865, 0.13114218315279824, 0.6251315638739416, 0.7629511495082409], [0.409850115610623, 0.2658504561987041, 0.7972602137102663, 0.672566499347781, 0.5870160521494598, 0.5952736535405827], [0.41813755491924665, 0.22566753799126224, 0.7630349176235699, 0.7490879386042969, 0.5672856594257116, 0.3529356900003867], [0.29928510423781973, 0.37751401840974264, 0.13287678951989174, 0.2115079504437662, 0.5920749580673739, 0.7409149292576324], [0.75444267082754, 0.471643068319888, 0.5424680258481066, 0.13122303474927505, 0.34706740404740744, 0.11370876353412504], [0.3891995580252595, 0.47923840384685, 0.22969506290023656, 0.23412927469123462, 0.5732153290519264, 0.3794576567285268], [0.6162150037375929, 0.19854976632071755, 0.5706333918831986, 0.6270492640689076, 0.126579004497459, 0.2030619387528289], [0.5064845580786764, 0.343830649433956, 0.7467527091633458, 0.5658146692640105, 0.6713239343707252, 0.40278134632391294]]]}
json_data = json.dumps(json_data)  # Convert dictionary to JSON string


# @app.route('/incomes', methods=['GET', 'POST'])
# def get_incomes():
#     if request.method == 'POST':
#
#         json_dataa = request.get_json()# Retrieve JSON data from the POST request
#         json_dataa=json.dumps(json_dataa)
#
#         # Parse the JSON data
#         parsed_data = json.loads(json_dataa)
#
#
#         data_list = parsed_data['data'][0]  # Extract the nested list
#
#         # Convert the nested list into a NumPy array
#         tensor = np.array(data_list)
#
#         # Reshape the tensor to the desired shape [1, 200, 6]
#         reshaped_tensor = tensor.reshape((1, 200, 6))
#
#         # Convert the reshaped tensor back to a nested list
#         reshaped_list = reshaped_tensor.tolist()
#
#         # Create a dictionary with the reshaped list
#         response_data = {
#             "data": reshaped_list
#         }
#
#         # Return the JSON response
#         return jsonify(response_data)

@app.route('/velocity', methods=['GET', 'POST'])
def get_velocity():
    if request.method == 'POST':
        import time
        a=time.time()

        json_dataa = request.get_json()# Retrieve JSON data from the POST request
        json_dataa=json.dumps(json_dataa)

        b=time.time()
        print(b-a)


        # Parse the JSON data
        parsed_data = json.loads(json_dataa)


        data_list = parsed_data['data'][0]  # Extract the nested list

        # Convert the nested list into a NumPy array
        tensor = np.array(data_list)

        # Reshape the tensor to the desired shape [1, 200, 6]
        reshaped_tensor = tensor.reshape((1, 200, 6))
        preprocessed_imu=preprocess(reshaped_tensor)
        velocities=network(preprocessed_imu)
        # import pdb
        # pdb.set_trace()

        # Convert the reshaped tensor back to a nested list
        # reshaped_list = reshaped_tensor.tolist()
        velocities_list=velocities.tolist()



        # Create a dictionary with the reshaped list
        response_data = {
            "data": velocities_list
        }

        # Return the JSON response
        return jsonify(response_data)





@app.route('/incomes', methods=['POST'])
def add_income():
    print(request.get_json())
    train_dataset = get_dataset_from_list_2("D:\\000_Mora\\FYP\\RONiN\\Ronin_DataSets\\seen_subjects_test_set",
                                            [request.get_json()['option']])
    train_loader = DataLoader(train_dataset, 1, shuffle=True)
    json_output={
        'out_data':[]
    }
    for bid, (feat, targ, _, _) in enumerate(train_loader):
        pred = network(feat.to(device)).cpu().detach().numpy()
        time.sleep(1)
        print(pred[0])
    print(request.get_json())
    return '', 204

if __name__=='__main__':
    app.run(host='0.0.0.0',port=5000)
